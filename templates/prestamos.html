{{define "title"}}Registrar Pr√©stamo | Biblioteca PUCE{{end}}

{{define "content"}}
<div class="container my-5">
    <h2 class="mb-4 text-center">üìö Registrar Nuevo Pr√©stamo</h2>
    <p class="lead text-center mb-3">Selecciona un libro y la fecha para registrar un pr√©stamo.</p>

    {{/* Mensajes de √©xito o error */}}
    {{if .Mensaje}}
    <div class="alert alert-{{.TipoMensaje}} alert-dismissible fade show" role="alert">
        {{.Mensaje}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {{end}}

    <form method="POST" action="/prestamos" class="mx-auto p-4 border rounded shadow-sm" style="max-width: 600px; background-color: #ffffff;">
        <div class="mb-3">
            <label for="libroID" class="form-label">Libro</label>
            <select class="form-select" id="libroID" name="libroID" required>
                <option value="">Seleccione un libro</option>
                {{range .LibrosDisponibles}}
                <option value="{{.ID}}">{{.Nombre}} ({{.Autor}}) - Copias disponibles: {{.Copias}}</option>
                {{end}}
            </select>
            <small class="form-text text-muted">Se muestran todos los libros. El sistema verificar√° la disponibilidad al registrar.</small>
        </div>
        <div class="mb-3">
            <label for="usuarioNombreDisplay" class="form-label">Usuario</label>
            <input type="text" class="form-control" id="usuarioNombreDisplay" value="{{.Usuario}}" readonly>
            <small class="form-text text-muted">El pr√©stamo se registrar√° a nombre de tu usuario actual.</small>
        </div>
        <div class="mb-3">
            <label for="fecha" class="form-label">Fecha del Pr√©stamo</label>
            <input type="date" class="form-control" id="fecha" name="fecha" required readonly> {{/* A√±adido readonly */}}
            <small class="form-text text-muted">La fecha actual se selecciona por defecto y no se puede modificar.</small>
        </div>
        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-success btn-lg">Registrar Pr√©stamo <i class="fas fa-handshake ms-2"></i></button>
        </div>
    </form>
</div>

<script>
    // Script para asegurar que la fecha actual se establezca al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0'); // Meses son 0-index
        const day = String(today.getDate()).padStart(2, '0');
        const formattedDate = `${year}-${month}-${day}`;
        document.getElementById('fecha').value = formattedDate;
    });
</script>
{{end}}
